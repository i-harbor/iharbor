"use strict";(self["webpackChunkiharbor_front"]=self["webpackChunkiharbor_front"]||[]).push([[12],{5977:(e,l,a)=>{function o(e){return l=>l.length<=e?l:l.substr(0,e)+"..."}a.d(l,{Z:()=>o})},4850:(e,l,a)=>{function o(e,l=2){return a=>a/Math.pow(e,4)>=1?(a/Math.pow(e,4)).toFixed(l)+" TB":a/Math.pow(e,3)>=1?(a/Math.pow(e,3)).toFixed(l)+" GB":a/Math.pow(e,2)>=1?(a/Math.pow(e,2)).toFixed(l)+" MB":a/e>=1?(a/e).toFixed(l)+" KB":a.toFixed(l)+" Byte"}a.d(l,{Z:()=>o})},3012:(e,l,a)=>{a.r(l),a.d(l,{default:()=>ye});var o=a(3673),t=a(1959),i=a(2323),s=a(4755),d=a(5948),r=a(5977),c=a(4850),n=a(5487),u=function(e,l,a,o){function t(e){return e instanceof a?e:new a((function(l){l(e)}))}return new(a||(a=Promise))((function(a,i){function s(e){try{r(o.next(e))}catch(l){i(l)}}function d(e){try{r(o["throw"](e))}catch(l){i(l)}}function r(e){e.done?a(e.value):t(e.value).then(s,d)}r((o=o.apply(e,l||[])).next())}))};const p=e=>((0,o.dD)("data-v-eee717f6"),e=e(),(0,o.Cn)(),e),m={class:"PathTable"},w={class:"row q-gutter-md"},v={class:"row items-center q-gutter-sm q-py-sm text-grey"},b={class:"col-auto"},h=(0,o.Uk)("返回上一级"),g=p((()=>(0,o._)("div",{class:"col-auto"}," | ",-1))),f={class:"row items-center no-wrap"},y=p((()=>(0,o._)("div",{class:"col-auto"},"全部存储桶",-1))),_={class:"row items-center no-wrap"},k={class:"row items-center no-wrap"},S={class:"col-auto"},U={class:"row items-center no-wrap"},x={class:"col-auto text-bold"},W={class:"row"},j={class:"col"},z={class:"row items-center no-wrap"},I={class:"col-auto text-black"},q={class:"row items-center no-wrap"},D={class:"col-auto"},O={key:0},Z={key:1},C=(0,o.Uk)("删除"),F=(0,o.Uk)("重命名"),Q=(0,o.Uk)("公开分享"),A={class:"col-auto bg-grey-1 q-mx-sm rounded-borders q-pa-sm",style:{height:"calc(100vh - 175px)",width:"300px"}},P={key:0},N={key:1,class:"column q-gutter-md"},T={class:"col-auto text-bold"},B={class:"col-auto"},L={class:"col-auto"},M={class:"col-auto"},V={class:"col-auto"},E={class:"col-auto"},H={class:"col-auto"},$={class:"col-auto"},K=(0,o.Uk)("下载"),R=(0,o.aZ)({props:{pathObj:{type:Object,required:!0}},setup(e){const l=e,a=(0,s.useStore)(),{locale:p}=(0,d.QT)({useScope:"global"}),R=(0,o.Fl)((()=>{var e;return null===(e=l.pathObj)||void 0===e?void 0:e.bucket_name})),Y=(0,o.Fl)((()=>{var e;return null===(e=l.pathObj)||void 0===e?void 0:e.dir_path})),G=(0,o.Fl)((()=>{var e,a,o,t;return""===(null===(a=null===(e=l.pathObj)||void 0===e?void 0:e.dir_path)||void 0===a?void 0:a.split("/")[0])?[]:null===(t=null===(o=l.pathObj)||void 0===o?void 0:o.dir_path)||void 0===t?void 0:t.split("/")})),J=(0,o.Fl)((()=>{var e,l,a;return""===Y.value?"/my/bucket":`/my/bucket/file?bucket=${R.value}&path=${-1===(null===(e=Y.value)||void 0===e?void 0:e.lastIndexOf("/"))?"":null===(l=Y.value)||void 0===l?void 0:l.slice(0,null===(a=Y.value)||void 0===a?void 0:a.lastIndexOf("/"))}`})),X=(0,t.iH)([]),ee=(0,t.iH)(),le=(0,r.Z)(7),ae=(0,r.Z)(70),oe=(0,c.Z)(1024),te=(0,o.Fl)((()=>[{name:"name",label:"zh"===p.value?"文件名":"File Name",field:"name",align:"left",headerStyle:"padding: 0 0 0 1px",style:"max-width: 1200px;padding: 15px 0px",classes:"ellipsis",sortable:!0},{name:"time",label:"zh"===p.value?"上传时间":"Upload Time",field:"time",align:"left",headerStyle:"padding: 0 0 0 1px",style:"width: 500px",classes:"",sortable:!0},{name:"size",label:"zh"===p.value?"文件大小":"File Size",field:"size",align:"left",headerStyle:"padding: 0 0 0 1px",style:"width: 500px",classes:"",sortable:!0},{name:"access",label:"zh"===p.value?"访问权限":"Accessibility",field:"access",align:"left",headerStyle:"padding: 0 0 0 1px",style:"width: 500px",classes:""},{name:"operation",label:"zh"===p.value?"操作":"Operations",field:"operation",align:"left",headerStyle:"padding: 0 0 0 1px",style:"width: 500px",classes:""}])),ie=(e,o)=>{const t=[];t.push(e),!1===o?a.dispatch("obs/triggerDeleteFolderDialog",{localId:l.pathObj.localId,dirNames:{dirArrs:t}}):a.dispatch("obs/triggerDeleteFolderDialog",{localId:l.pathObj.localId,dirNames:{fileArrs:t}})},se=e=>{a.dispatch("obs/triggerChangeFolderDialog",{localId:l.pathObj.localId,dirName:e})},de=()=>u(this,void 0,void 0,(function*(){const e=[],o=[];X.value.forEach((l=>{!1===l.fod?e.push(l.name):o.push(l.name)})),yield a.dispatch("obs/triggerDeleteFolderDialog",{localId:l.pathObj.localId,dirNames:{dirArrs:e,fileArrs:o}})})),re=(e,o,t)=>u(this,void 0,void 0,(function*(){const i=[];i.push(e),0===o?!1===t?yield a.dispatch("obs/triggerPublicShareDialog",{localId:l.pathObj.localId,dirNames:{dirArrs:i}}):yield a.dispatch("obs/triggerPublicShareDialog",{localId:l.pathObj.localId,dirNames:{fileArrs:i}}):!1===t?yield a.dispatch("obs/triggerAlreadyShareDialog",{localId:l.pathObj.localId,dirNames:{dirArrs:i}}):yield a.dispatch("obs/triggerAlreadyShareDialog",{localId:l.pathObj.localId,dirNames:{fileArrs:i}})})),ce=()=>u(this,void 0,void 0,(function*(){const e=[],o=[];X.value.forEach((l=>{!1===l.fod?e.push(l.name):o.push(l.name)})),yield a.dispatch("obs/triggerPublicShareDialog",{localId:l.pathObj.localId,dirNames:{dirArrs:e,fileArrs:o}})})),ne=e=>u(this,void 0,void 0,(function*(){const a=l.pathObj.localId+"/"+e,o=yield n.Wh.api.getObjPath({path:{objpath:a}}),t=window.URL.createObjectURL(new Blob([o.data])),i=document.createElement("a");i.style.display="none",i.href=t,i.setAttribute("download",e),document.body.appendChild(i),i.click()}));return(0,o.YP)((()=>{var e;return null===(e=l.pathObj)||void 0===e?void 0:e.files}),(()=>{X.value=[]}),{immediate:!0,deep:!0}),(e,s)=>{var d;const r=(0,o.up)("q-btn"),c=(0,o.up)("q-icon"),n=(0,o.up)("q-breadcrumbs-el"),u=(0,o.up)("q-breadcrumbs"),ue=(0,o.up)("q-checkbox"),pe=(0,o.up)("q-td"),me=(0,o.up)("q-item-label"),we=(0,o.up)("q-item-section"),ve=(0,o.up)("q-item"),be=(0,o.up)("q-list"),he=(0,o.up)("q-btn-dropdown"),ge=(0,o.up)("q-tr"),fe=(0,o.up)("q-table"),ye=(0,o.Q2)("close-popup");return(0,o.wg)(),(0,o.iD)("div",m,[(0,o._)("div",w,[(0,o.Wm)(r,{class:"col-auto",unelevated:"",color:"primary",label:"创建文件夹",onClick:s[0]||(s[0]=e=>(0,t.SU)(a).dispatch("obs/triggerCreateFolderDialog",{dirName:l.pathObj.localId}))}),(0,o.Wm)(r,{class:"col-auto",unelevated:"",color:"primary",label:"上传文件",onClick:s[1]||(s[1]=e=>(0,t.SU)(a).dispatch("obs/triggerUploadDialog",{bucket_name:l.pathObj.localId}))}),(0,o.Wm)(r,{class:"col-auto",unelevated:"",color:"primary",label:"删除文件",onClick:de,disable:!(X.value.length>0)},null,8,["disable"]),(0,o.Wm)(r,{class:"col-auto",unelevated:"",color:"primary",label:"公开分享",onClick:ce,disable:!(X.value.length>0)},null,8,["disable"])]),(0,o._)("div",v,[(0,o._)("div",b,[(0,o.Wm)(r,{flat:"",color:"primary",padding:"none",to:(0,t.SU)(J)},{default:(0,o.w5)((()=>[h])),_:1},8,["to"])]),g,(0,o.Wm)(u,{class:"col-auto text-black"},{separator:(0,o.w5)((()=>[(0,o.Wm)(c,{size:"xs",name:"chevron_right",color:"grey"})])),default:(0,o.w5)((()=>{var e,l;return[(0,o.Wm)(n,{to:"/my/bucket"},{default:(0,o.w5)((()=>[(0,o._)("div",f,[(0,o.Wm)(c,{class:"col-auto",size:"xs",color:"yellow-8",name:"mdi-database"}),y])])),_:1}),(0,o.Wm)(n,{to:"/my/bucket/file?bucket="+(0,t.SU)(R)},{default:(0,o.w5)((()=>{var e;return[(0,o._)("div",_,[(0,o.Wm)(c,{class:"col-auto",size:"xs",color:"yellow-8",name:"mdi-database"}),(0,o._)("div",{class:(0,i.C_)(["col-auto",0===(null===(e=(0,t.SU)(G))||void 0===e?void 0:e.length)?"text-bold":""])},(0,i.zw)((0,t.SU)(R)),3)])]})),_:1},8,["to"]),((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(null===(e=(0,t.SU)(G))||void 0===e?void 0:e.slice(0,-1),((e,l)=>{var a;return(0,o.wg)(),(0,o.j4)(n,{key:e,to:"/my/bucket/file?bucket="+(0,t.SU)(R)+"&path="+(null===(a=(0,t.SU)(Y))||void 0===a?void 0:a.split((0,t.SU)(G)[l+1])[0].slice(0,-1))},{default:(0,o.w5)((()=>[(0,o._)("div",k,[(0,o.Wm)(c,{class:"col-auto",size:"xs",color:"yellow-8",name:"folder"}),(0,o._)("div",S,(0,i.zw)((0,t.SU)(le)(e)),1)])])),_:2},1032,["to"])})),128)),(null===(l=(0,t.SU)(G))||void 0===l?void 0:l.length)>0?((0,o.wg)(),(0,o.j4)(n,{key:0},{default:(0,o.w5)((()=>{var e;return[(0,o._)("div",U,[(0,o.Wm)(c,{class:"col-auto",size:"xs",color:"yellow-8",name:"folder"}),(0,o._)("div",x,(0,i.zw)((0,t.SU)(ae)(null===(e=(0,t.SU)(G))||void 0===e?void 0:e.slice(-1)[0])),1)])]})),_:1})):(0,o.kq)("",!0)]})),_:1})]),(0,o._)("div",W,[(0,o._)("div",j,[(0,o.Wm)(fe,{class:"rounded-borders",flat:"",square:"","table-header-class":"bg-grey-1 text-grey",rows:null===(d=l.pathObj)||void 0===d?void 0:d.files,columns:(0,t.SU)(te),"row-key":"name","hide-pagination":"",pagination:{rowsPerPage:0},loading:"loading"===(0,t.SU)(a).state.obs.tables.pathTable.status,"no-data-label":"没有文件",selection:"multiple",selected:X.value,"onUpdate:selected":s[2]||(s[2]=e=>X.value=e)},{"header-selection":(0,o.w5)((e=>[(0,o.Wm)(ue,{style:{},modelValue:e.selected,"onUpdate:modelValue":l=>e.selected=l,dense:"",size:"xs"},null,8,["modelValue","onUpdate:modelValue"])])),body:(0,o.w5)((e=>[(0,o.Wm)(ge,{props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(pe,{"auto-width":""},{default:(0,o.w5)((()=>[(0,o.Wm)(ue,{modelValue:e.selected,"onUpdate:modelValue":l=>e.selected=l,dense:"",size:"xs"},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024),(0,o.Wm)(pe,{key:"name",props:e},{default:(0,o.w5)((()=>[e.row.fod?(0,o.kq)("",!0):((0,o.wg)(),(0,o.j4)(r,{key:0,flat:"","no-caps":"",padding:"none",to:"/my/bucket/file?bucket="+(0,t.SU)(R)+"&path="+((0,t.SU)(Y)?(0,t.SU)(Y)+"/":"")+e.row.name},{default:(0,o.w5)((()=>[(0,o._)("div",z,[(0,o.Wm)(c,{class:"col-auto",color:"yellow-8",name:"folder"}),(0,o._)("div",I,(0,i.zw)((0,t.SU)(ae)(e.row.name)),1)])])),_:2},1032,["to"])),e.row.fod?((0,o.wg)(),(0,o.j4)(r,{key:1,flat:"","no-caps":"",color:"black",padding:"none",ripple:!1,onClick:l=>ee.value=e.row},{default:(0,o.w5)((()=>[(0,o._)("div",q,[(0,o.Wm)(c,{class:"col-auto",color:"grey",name:"insert_drive_file"}),(0,o._)("div",D,(0,i.zw)((0,t.SU)(ae)(e.row.name)),1)])])),_:2},1032,["onClick"])):(0,o.kq)("",!0)])),_:2},1032,["props"]),(0,o.Wm)(pe,{key:"time",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(new Date(e.row.ult).toLocaleString((0,t.SU)(p))),1)])),_:2},1032,["props"]),(0,o.Wm)(pe,{key:"size",props:e},{default:(0,o.w5)((()=>[e.row.fod?((0,o.wg)(),(0,o.iD)("div",Z,(0,i.zw)((0,t.SU)(oe)(e.row.si)),1)):((0,o.wg)(),(0,o.iD)("div",O," -"))])),_:2},1032,["props"]),(0,o.Wm)(pe,{key:"access",props:e},{default:(0,o.w5)((()=>[(0,o.Uk)((0,i.zw)(e.row.access_permission),1)])),_:2},1032,["props"]),(0,o.Wm)(pe,{key:"operation",props:e},{default:(0,o.w5)((()=>[(0,o.Wm)(he,{label:"操作"},{default:(0,o.w5)((()=>[(0,o.Wm)(be,null,{default:(0,o.w5)((()=>[(0,o.wy)(((0,o.wg)(),(0,o.j4)(ve,{clickable:"",onClick:l=>ie(e.row.name,e.row.fod)},{default:(0,o.w5)((()=>[(0,o.Wm)(we,null,{default:(0,o.w5)((()=>[(0,o.Wm)(me,null,{default:(0,o.w5)((()=>[C])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[ye]]),!0===e.row.fod?(0,o.wy)(((0,o.wg)(),(0,o.j4)(ve,{key:0,clickable:"",onClick:l=>se(e.row.name)},{default:(0,o.w5)((()=>[(0,o.Wm)(we,null,{default:(0,o.w5)((()=>[(0,o.Wm)(me,null,{default:(0,o.w5)((()=>[F])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[ye]]):(0,o.kq)("",!0),(0,o.wy)(((0,o.wg)(),(0,o.j4)(ve,{clickable:"",onClick:l=>re(e.row.name,e.row.access_code,e.row.fod)},{default:(0,o.w5)((()=>[(0,o.Wm)(we,null,{default:(0,o.w5)((()=>[(0,o.Wm)(me,null,{default:(0,o.w5)((()=>[Q])),_:1})])),_:1})])),_:2},1032,["onClick"])),[[ye]])])),_:2},1024)])),_:2},1024)])),_:2},1032,["props"])])),_:2},1032,["props"])])),_:1},8,["rows","columns","loading","selected"])]),(0,o._)("div",A,[ee.value?((0,o.wg)(),(0,o.iD)("div",N,[(0,o._)("div",T,(0,i.zw)(ee.value.name),1),(0,o._)("div",B," 创建时间: "+(0,i.zw)(new Date(ee.value.ult).toLocaleString((0,t.SU)(p))),1),(0,o._)("div",L," 最后修改: "+(0,i.zw)(new Date(ee.value.upt).toLocaleString((0,t.SU)(p))),1),(0,o._)("div",M," 文件大小: "+(0,i.zw)((0,t.SU)(oe)(ee.value.si)),1),(0,o._)("div",V," 访问权限: "+(0,i.zw)(ee.value.access_permission),1),(0,o._)("div",E," 下载次数: "+(0,i.zw)(ee.value.dlc),1),(0,o._)("div",H," MD5: "+(0,i.zw)(ee.value.md5),1),(0,o._)("div",$,[(0,o.Wm)(r,{color:"primary",unelevated:"",onClick:s[3]||(s[3]=e=>ne(ee.value.name))},{default:(0,o.w5)((()=>[K])),_:1})])])):((0,o.wg)(),(0,o.iD)("div",P,(0,i.zw)(e.$t("请点击要查看的文件")),1))])])])}}});var Y=a(4260),G=a(2165),J=a(1481),X=a(4554),ee=a(5926),le=a(6429),ae=a(5735),oe=a(8886),te=a(8186),ie=a(3884),se=a(2670),de=a(7011),re=a(3414),ce=a(2035),ne=a(2350),ue=a(677),pe=a(7518),me=a.n(pe);const we=(0,Y.Z)(R,[["__scopeId","data-v-eee717f6"]]),ve=we;me()(R,"components",{QBtn:G.Z,QBreadcrumbs:J.Z,QIcon:X.Z,QBreadcrumbsEl:ee.Z,QTable:le.Z,QCheckbox:ae.Z,QToggle:oe.Z,QTr:te.Z,QTd:ie.Z,QBtnDropdown:se.Z,QList:de.Z,QItem:re.Z,QItemSection:ce.Z,QItemLabel:ne.Z}),me()(R,"directives",{ClosePopup:ue.Z});var be=a(9582);const he={class:"PathList"},ge=(0,o.aZ)({setup(e){const l=(0,s.useStore)(),a=(0,be.yj)(),i=a.query.bucket,d=a.query.path,r=i+(d?"/"+d:"");l.dispatch("obs/addPathTable",{bucket:i,path:d});const c=(0,o.Fl)((()=>l.state.obs.tables.pathTable.byLocalId[r]));return(e,l)=>((0,o.wg)(),(0,o.iD)("div",he,[(0,o.Wm)(ve,{pathObj:(0,t.SU)(c)},null,8,["pathObj"])]))}}),fe=(0,Y.Z)(ge,[["__scopeId","data-v-660bde17"]]),ye=fe}}]);